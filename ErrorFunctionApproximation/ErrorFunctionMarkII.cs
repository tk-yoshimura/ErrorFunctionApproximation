using static System.Math;

namespace ErrorFunctionApproximation {
    public static class ErrorFunctionMarkII {
        public static double Erf(double x) {
            if (double.IsNaN(x)) {
                return double.NaN;
            }
            if (x < 0.0) {
                return -Erf(Abs(x));
            }

            if (x < 0.5) {
                return ErfNearZero(x);
            }
            if (x < 1.0) {
                return 1.0 - ErfcPlusP5(x);
            }
            if (x < 2.0) {
                return 1.0 - ErfcPlus1(x);
            }
            if (x < 4.0) {
                return 1.0 - ErfcPlus2(x);
            }
            if (x < 8.0) {
                return 1.0 - ErfcPlus4(x);
            }

            return 1.0;
        }

        public static double Erfc(double x) {
            if (double.IsNaN(x)) {
                return double.NaN;
            }

            if (x < 0.5) {
                return 1.0 - Erf(x);
            }
            if (x < 1.0) {
                return ErfcPlusP5(x);
            }
            if (x < 2.0) {
                return ErfcPlus1(x);
            }
            if (x < 4.0) {
                return ErfcPlus2(x);
            }
            if (x < 8.0) {
                return ErfcPlus4(x);
            }
            if (x < 16.0) {
                return ErfcPlus8(x);
            }
            if (x < 27.25) {
                return ErfcPlus16(x);
            }

            return 0.0;
        }

        private static double ErfNearZero(double x) {
            double w = x * x;

            double u = (
                1.12837916709551257390e0 + w * (
                1.41992244117798429234e-1 + w * (
                4.52195919383661078468e-2 + w * (
                1.81571926199746178752e-3 + w *
                1.92899332746423909221e-4))))
                / (
                1.00000000000000000000e0 + w * (
                4.59170683275987299444e-1 + w * (
                9.31317143590956177199e-2 + w * (
                1.05454995673356468502e-2 + w * (
                6.75953355582711700711e-4 + w *
                1.99751561392946360834e-5)))));

            double y = x * u;

            return y;
        }

        private static double ErfcPlusP5(double x) {
            double w = x - 0.5;

            double u = (
                1.00000000000000000000e0 + w * (
                1.34099976999121329590e0 + w * (
                8.56762978144288861443e-1 + w * (
                3.16570587181473309350e-1 + w * (
                7.05798099110973092777e-2 + w * (
                8.92998004186820217446e-3 + w *
                5.00239328430236539100e-4))))))
                / (
                1.62419308574807066971e0 + w * (
                3.53051729947024079596e0 + w * (
                3.38347446398070396153e0 + w * (
                1.85669816101497046144e0 + w * (
                6.31463529762465612180e-1 + w * (
                1.33441854070762465425e-1 + w * (
                1.62726723432911469379e-2 + w *
                8.86583249851894459219e-4)))))));

            double y = Exp(-x * x) * u;

            return y;
        }

        private static double ErfcPlus1(double x) {
            double w = x - 1.0;

            double u = (
                1.00000000000000000000e0 + w * (
                1.50314224721654127642e0 + w * (
                1.04476336774122843193e0 + w * (
                4.26889879050711362051e-1 + w * (
                1.09935724575582226688e-1 + w * (
                1.77735261175907078409e-2 + w * (
                1.66761213238888643314e-3 + w *
                7.00293677081427709050e-5)))))))
                / (
                2.33872406651000647661e0 + w * (
                5.00980365221224034376e0 + w * (
                4.80015965515186399462e0 + w * (
                2.69016407758612841845e0 + w * (
                9.65783251517281689174e-1 + w * (
                2.27773183728755448353e-1 + w * (
                3.45207187382309254048e-2 + w * (
                3.07987987255160486906e-3 + w *
                1.24124178972110154556e-4))))))));

            double y = Exp(-x * x) * u;

            return y;
        }

        private static double ErfcPlus2(double x) {
            double w = x - 2.0;

            double u = (
                1.00000000000000000000e0 + w * (
                1.54789172892709681253e0 + w * (
                1.08732691359437197452e0 + w * (
                4.50760649484611848536e-1 + w * (
                1.20340580111242787211e-1 + w * (
                2.11598919778364788400e-2 + w * (
                2.39169506541366076969e-3 + w * (
                1.58871052785301256315e-4 + w *
                4.75003546471038792860e-6))))))))
                / (
                3.91549306725230897235e0 + w * (
                7.69806507033900444546e0 + w * (
                6.83556849290924291721e0 + w * (
                3.60033851351004657099e0 + w * (
                1.24047612045121162177e0 + w * (
                2.90158593990291689591e-1 + w * (
                4.61156483147089573007e-2 + w * (
                4.80656185549192240090e-3 + w * (
                2.98430051654960595459e-4 + w *
                8.41921851559063070821e-6)))))))));

            double y = Exp(-x * x) * u;

            return y;
        }

        private static double ErfcPlus4(double x) {
            double w = x - 4.0;

            double u = (
                1.00000000000000000000e0 + w * (
                1.25746170311257204438e0 + w * (
                7.03808332270199051823e-1 + w * (
                2.28892390212618636873e-1 + w * (
                4.72951835938663487710e-2 + w * (
                6.35712058181220292220e-3 + w * (
                5.42839661005351321710e-4 + w * (
                2.69272815311508576646e-5 + w *
                5.94216970374386786069e-7))))))))
                / (
                7.29929897048781762900e0 + w * (
                1.09039745244909594419e1 + w * (
                7.31699851898786526319e0 + w * (
                2.89571228902039492291e0 + w * (
                7.45055426257682045346e-1 + w * (
                1.29292865258882582078e-1 + w * (
                1.51380930848769294948e-2 + w * (
                1.15359431397539239090e-3 + w * (
                5.19402524758985255038e-5 + w *
                1.05322215737521862732e-6)))))))));

            double y = Exp(-x * x) * u;

            return y;
        }

        private static double ErfcPlus8(double x) {
            double w = x - 8.0;

            double u = (
                1.00000000000000000000e0 + w * (
                1.25746170311257204438e0 + w * (
                7.03808332270199051823e-1 + w * (
                2.28892390212618636873e-1 + w * (
                4.72951835938663487710e-2 + w * (
                6.35712058181220292220e-3 + w * (
                5.42839661005351321710e-4 + w * (
                2.69272815311508576646e-5 + w *
                5.94216970374386786069e-7))))))))
                / (
                7.29929897048781762900e0 + w * (
                1.09039745244909594419e1 + w * (
                7.31699851898786526319e0 + w * (
                2.89571228902039492291e0 + w * (
                7.45055426257682045346e-1 + w * (
                1.29292865258882582078e-1 + w * (
                1.51380930848769294948e-2 + w * (
                1.15359431397539239090e-3 + w * (
                5.19402524758985255038e-5 + w *
                1.05322215737521862732e-6)))))))));

            double y = Exp(-x * x) * u;

            return y;
        }

        private static double ErfcPlus16(double x) {
            double w = x - 16.0;

            double u = (
                1.00000000000000000000e0 + w * (
                3.01131564001861798828e-1 + w * (
                3.63647817146354655538e-2 + w * (
                2.20132258260920223731e-3 + w * (
                6.67982674643708596687e-5 + w *
                8.12863261006534035097e-7)))))
                / (
                2.84144365162813186597e1 + w * (
                1.03255156563650534155e1 + w * (
                1.56620755225060452355e0 + w * (
                1.26930452727791373837e-1 + w * (
                5.79681261235647022363e-3 + w * (
                1.41449048276726826659e-4 + w *
                1.44076261723069040035e-6))))));

            double y = Exp(-x * x) * u;

            return y;
        }
    }
}
